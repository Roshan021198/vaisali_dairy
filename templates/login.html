{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>
    Fastland- Landing Page Template for SaaS, Startup & Agency
  </title>
  <link rel="shortcut icon" href="{% static 'homepage/image/png/favicon1.png' %}" type="image/x-icon">
  <!-- Bootstrap , fonts & icons  -->
  <link rel="stylesheet" href="{% static 'homepage/css/bootstrap.css' %}">
  <link rel="stylesheet" href="{% static 'homepage/fonts/icon-font/css/style.css' %}">
  <link rel="stylesheet" href="{% static 'homepage/fonts/typography-font/typo.css' %}">
  <link rel="stylesheet" href="{% static 'homepage/fonts/fontawesome-5/css/all.css' %}">
  <!-- Plugin'stylesheets  -->
  <link rel="stylesheet" href="{% static 'homepage/plugins/aos/aos.min.css' %}">
  <link rel="stylesheet" href="{% static 'homepage/plugins/fancybox/jquery.fancybox.min.css' %}">
  <link rel="stylesheet" href="{% static 'homepage/plugins/nice-select/nice-select.min.css' %}">
  <link rel="stylesheet" href="{% static 'homepage/plugins/slick/slick.min.css' %}">
  <!-- Vendor stylesheets  -->
  <link rel="stylesheet" href="{% static 'homepage/plugins/theme-mode-switcher/switcher-panel.css' %}">
  <link rel="stylesheet" href="{% static 'homepage/css/main.css' %}">
  <!-- Custom stylesheet -->
</head>

<body data-theme-mode-panel-active data-theme="light">
  <div class="site-wrapper overflow-hidden ">
    <div id="loading">
      <img src="{% static 'homepage/image/preloader.gif' %}" alt="">
    </div>
    <!-- Clean The Code And Hop in -->
    <div class="form-block form-block--sign-in bg-default-3 vh-100 position-relative">
      <div class="container position-static vh-100">
        <div class="row align-items-center justify-content-center position-static vh-100">
          <div class="col-xl-6 col-lg-5 position-static vh-100 d-none d-lg-block">
            <div class="form-img position-absolute bg-image"
              style="background-image: url(/static/homepage/image/jpg/sign-in.jpg)">
            </div>
          </div>
          <div class="col-xxl-5 col-xl-6 col-lg-7 col-md-8 col-xs-10">
            <div class="section-title section-title--l5 pb-7">
              <h2 class="section-title__heading" data-aos="fade-up" data-aos-duration="500" data-aos-once="true">Sign In
                to your Account</h2>
              <p class="section-title__description" data-aos="fade-up" data-aos-duration="500" data-aos-delay="300"
                data-aos-once="true">Enter your account details below to log in.</p>
            </div>
            <div class="form-box form-box--sign-in" data-aos="fade-up" data-aos-duration="500" data-aos-delay="500"
              data-aos-once="true">
              <form method="POST" action="{% url 'dashboard_login' %}" class="contact-form" id="login_form"
                data-aos="fade-up" data-aos-duration="500" data-aos-delay="300" data-aos-once="true">{% csrf_token %}
                <div class="form-floating">
                  <input class="form-control" type="text" maxlength="10" name="contact_no"
                    placeholder="Leave a comment here" id="floatinginput" required />
                  <label for="floatinginput">Your Phone Number</label>
                </div>
                <div class="form-floating mb-4" id="errordiv" style="display: none;">
                  <span id="uname_error" style="font-weight: bold;color: red; margin-left: 50px;"></span>
                </div>
                <div class="form-floating">
                  <input class="form-control" type="password" name="password" placeholder="Leave a comment here"
                    id="floatinginput2" />
                  <label for="floatinginput2">Your Password</label>
                </div>

                <div class="form-check d-flex align-items-center mt-6 mb-3">
                  <input class="form-check-input bg-white float-none mt-0 mb-0" disabled type="checkbox" value=""
                    id="check_id">
                  <label class="form-check-label">Show Password</label>
                  <!-- for="flexCheckDefault" -->
                </div>
                <button type="button" class="btn btn-niagara shadow--primary-4 btn--lg-2 rounded-55 text-white mt-2"
                  id="submitbtn" disabled>Sign In</button>
              </form>
              <div class="buttons mt-6" data-aos="fade-up" data-aos-duration="500" data-aos-delay="700"
                data-aos-once="true">
                <p><a class="btn-link text-electric-violet-2 ms-2" id="forget_pwd" href="#">Forget Password</a>
                </p>

                <p>If you don't have account<a class="btn-link text-electric-violet-2 ms-2"
                    href="{% url 'sign_up' %}">SIGN-UP</a> as new customer.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
    Launch demo modal
  </button>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> -->
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Form Submited Successfully. Please check your mail.</h6>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!--invalid passwod Modal -->
  <div class="modal fade" id="invalidUserPassword" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> -->
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Invalid Username or Password.</h6>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!--Forget passwod Modal -->
  <div class="modal fade" id="forget_uname_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Forget Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="forget_uname_input" class="form-control" placeholder="Registred Phone Number"
            maxlength="10" aria-label="Username" aria-describedby="basic-addon1" required>
        </div>
        <h6 style="text-align: center;color: red;" id="forget_username_msg"></h6>
        <h6 style="text-align: center;color: green;" id="without_emailid"></h6>
        <h6 style="text-align:center;">An OTP will be send to the email associated with this username..</h6>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-secondary" id="send_email_btn" data-bs-dismiss="modal" disabled>Send
            E-Mail</button>
        </div>
      </div>
    </div>
  </div>

  <!--otp Modal -->
  <div class="modal fade" id="otp_input_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">OTP</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="forget_otp_input" class="form-control" placeholder="Enter 4 digit OTP"
            aria-label="Username" aria-describedby="basic-addon1" required>
        </div>
        <h6 id="otp_error_msg" style="text-align: center;"></h6>
        <h6 style="text-align:center;">Enter the OTP you have received on your mail <span id="otp_email"
            style="font-weight: bold;color: green;"></span></h6>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-secondary" id="reset_pwd_btn" data-bs-dismiss="modal" disabled>Reset
            Password</button>
        </div>
      </div>
    </div>
  </div>


  <!--password set Modal -->
  <div class="modal fade" id="password_set_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Reset Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="password" id="reset_forget_password" class="form-control" placeholder="Enter new password"
            aria-label="Username" aria-describedby="basic-addon1" required>
          <br>
          <input type="password" id="reset_confirm_forget_password" class="form-control"
            placeholder="Enter confirm password" aria-label="Username" aria-describedby="basic-addon1" required>
        </div>
        <input type="hidden" id="username_hidden_field">
        <h6 id="password_match_msg" style="text-align: center;"></h6>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-secondary" id="update_pwd_btn" data-bs-dismiss="modal" disabled>Update
            Password</button>
        </div>
      </div>
    </div>
  </div>

  <!--passwod successful Modal -->
  <div class="modal fade" id="password_success_modal" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> -->
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Password Updated Successfylly !!</h6>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Plugin's Scripts -->
  <script src="{% static 'homepage/plugins/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'homepage/plugins/jquery/jquery-migrate.min.js' %}"></script>
  <script src="{% static 'homepage/js/bootstrap.bundle.js' %}"></script>
  <script src="{% static 'homepage/plugins/fancybox/jquery.fancybox.min.js' %}"></script>
  <script src="{% static 'homepage/plugins/nice-select/jquery.nice-select.min.js' %}"></script>
  <script src="{% static 'homepage/plugins/aos/aos.min.js' %}"></script>
  <script src="{% static 'homepage/plugins/counter-up/jquery.counterup.min.js' %}"></script>
  <script src="{% static 'homepage/plugins/counter-up/waypoints.min.js' %}"></script>
  <script src="{% static 'homepage/plugins/slick/slick.min.js' %}"></script>
  <script src="{% static 'homepage/plugins/skill-bar/skill.bars.jquery.js' %}"></script>
  <script src="{% static 'homepage/plugins/isotope/isotope.pkgd.min.js' %}"></script>
  <!--<script src="{% static 'homepageplugins/theme-mode-switcher/gr-theme-mode-switcher.js' %}"></script>-->
  <!-- Activation Script -->
  <script src="{% static 'homepage/js/menu.js' %}"></script>
  <script src="{% static 'homepage/js/custom.js' %}"></script>

  <script>

    $('#floatinginput').change(function () {
      var uname = $('#floatinginput').val();
      $.ajax({
        url: "{% url 'verify_uname' %}",
        data: {
          'uname': uname,
        },
        dataType: 'json',
        success: function (data) {
          console.log(data.exist);
          if (data.exist) {
            $("#errordiv").css("display", "none");
            document.getElementById('uname_error').innerText = " ";


          }
          else {
            $("#errordiv").css("display", "block");
            document.getElementById('uname_error').innerText = "Username doesn't exist...";
          }
        }
      })
    });

    $('#floatinginput2').keyup(function () {
      var value = $('#floatinginput2').val();
      if (value.length > 0) {
        $(check_id).prop('disabled', false);
        $(submitbtn).prop('disabled', false);
      }
      else {
        $(check_id).prop('disabled', true);
        $(submitbtn).prop('disabled', true);
      }
    });
    $(document).ready(function () {
      $('input[type="checkbox"]').click(function () {
        var x = document.getElementById("floatinginput2");
        if ($(this).prop("checked") == true) {
          x.type = "text";
        }
        else if ($(this).prop("checked") == false) {
          x.type = "password";
        }
      });
    });


    $('#submitbtn').on('click', function (e) {
      uname = document.getElementById('floatinginput').value;
      password = document.getElementById('floatinginput2').value;
      setTimeout(location.reload.bind(location), 60000);
      $.ajax({

        url: "{% url 'uname_pwd_check' %}",
        data: {
          'uname': uname,
          'pwd': password
        },
        dataType: 'json',
        success: function (data) {
          if (data.exist) {
            $('#login_form').submit();
          }
          else {

            $("#invalidUserPassword").modal('show');

          }
        },
      })

    });


    $('#forget_pwd').on('click', function () {
      $('#forget_uname_modal').modal('show');
    });


    $('#forget_uname_input').keyup(function () {
      uname = $('#forget_uname_input').val();
      document.getElementById('username_hidden_field').innerText = uname;

      $.ajax({
        url: "{% url 'forget_username' %}",
        data: {
          'uname': uname
        },
        dataType: 'json',
        success: function (data) {
          if (data.is_exist) {
            if (data.type === 'customer' && data.email === "panigrahi.babu98@gmail.com") {
              document.getElementById('without_emailid').innerText = "please contact on 9583219040 no for your OTP";
            }
            document.getElementById('forget_username_msg').style.color = 'green';
            document.getElementById('forget_username_msg').innerText = data.email;
            document.getElementById('otp_email').innerText = data.email;
            $('#send_email_btn').prop('disabled', false);
            $.ajax({
              url: "{% url 'forget_email_sending' %}",
              data: {
                'email': data.email
              },
              dataType: 'json',
              success: function (data) {
                document.getElementById('correct_otp_hidden').innerText = " ";

              }
            })
          }
          else {
            document.getElementById('forget_username_msg').style.color = 'red';
            document.getElementById('forget_username_msg').innerText = "Username doesn't exist !!";
            $('#send_email_btn').prop('disabled', true);
          }
        }
      })

    });





    $('#send_email_btn').on('click', function () {
      $('#forget_uname_modal').modal('hide');
      $('#otp_input_modal').modal('show');
    });

    $('#forget_otp_input').keyup(function () {
      entred_otp = $('#forget_otp_input').val();
      $.ajax({
        url: "{% url 'verify_otp' %}",
        data: {
          'entred_otp': entred_otp
        },
        dataType: 'json',
        success: function (data) {
          if (data.exist == 'true') {

            document.getElementById('otp_error_msg').style.color = 'green';
            document.getElementById('otp_error_msg').innerText = 'OTP Matched';
            // document.getElementById("login_form").action = ;

            $('#reset_pwd_btn').prop('disabled', false);


          }
          else {
            document.getElementById('otp_error_msg').style.color = 'red';
            document.getElementById('otp_error_msg').innerText = "OTP did not Match";
            $('#reset_pwd_btn').prop('disabled', true);
          }
        }
      })

    });

    $('#reset_pwd_btn').on('click', function () {
      $('#otp_input_modal').modal('hide');
      $('#password_set_modal').modal('show');
    });

    $('#reset_confirm_forget_password').keyup(function () {
      password = $('#reset_forget_password').val();
      cpassword = $('#reset_confirm_forget_password').val();
      if (password === cpassword) {
        document.getElementById('password_match_msg').style.color = 'green';
        document.getElementById('password_match_msg').innerText = 'Password Matched';
        $('#update_pwd_btn').prop('disabled', false);
      }
      else {
        document.getElementById('password_match_msg').style.color = 'red';
        document.getElementById('password_match_msg').innerText = "Password Doesn't Matched";
        $('#update_pwd_btn').prop('disabled', true);
      }
    });


    $('#update_pwd_btn').on('click', function () {
      password = $('#reset_forget_password').val();
      uname = document.getElementById('username_hidden_field').innerText;

      $.ajax({
        url: "{% url 'set_password' %}",
        data: {
          'password': password,
          'username': uname
        },
        dataType: 'json',
        success: function (data) {
          $('#password_success_modal').modal('show');
          $('#password_set_modal').modal('hide');
        }
      })
    });

  </script>
</body>

</html>